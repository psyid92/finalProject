<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="storereview">
<select id="reviewRepSeq" resultType="Integer">
		SELECT reviewreply_seq.NEXTVAl FROM dual
	</select>

<select id="reviewlistAll" resultType="com.sp.store.mystore.MyStoreReview">
	select g.rep_Num, rep_Created, rep_star, rep_content, rrep_num, rrep_Created, rrep_content, m1_Nickname, g.g1_num, g1_Name
    from giupreview g
	left outer join reviewphoto r on g.rep_Num = r.rep_Num
	left outer join reviewreply r on g.rep_Num = r.rep_Num
    left outer join member1 m on  g.m1_NUm = m.m1_Num
    left outer join giup1 gi on g.g1_Num = gi.g1_Num
	where g.g1_Num = #{g1_Num}
	order by rep_created desc
</select>

<select id="reviewlistYet" resultType="com.sp.store.mystore.MyStoreReview">
	select g.rep_Num, rep_Created, rep_star, rep_content, rrep_num, rrep_Created, rrep_content, m1_Nickname, g.g1_num, g1_Name
    from giupreview g
	left outer join reviewphoto r on g.rep_Num = r.rep_Num
	left outer join reviewreply r on g.rep_Num = r.rep_Num
    left outer join member1 m on  g.m1_NUm = m.m1_Num
    left outer join giup1 gi on g.g1_Num = gi.g1_Num
	where rrep_Num IS NULL AND g.g1_Num = #{g1_Num} 
	order by rep_created desc
</select>


<insert id="insertReply" parameterType="com.sp.store.mystore.MyStoreReview">
	INSERT INTO reviewreply(rrep_Num, rrep_Content, rep_Num, g1_Num)
				 VALUES(${rrep_Num}, #{rrep_Content}, #{rep_Num}, #{g1_Num})
</insert>

<delete id="deleteReply" parameterType="Integer">
	DELETE FROM reviewreply WHERE rrep_Num=#{rrep_Num};
</delete>

<update id="updateReply" parameterType="Integer">
	UPDATE reviewreply SET rep_Content = #{rep_Content} where rrep_Num = #{rrep_Num}
</update>

<select id="dataCount" resultType="Integer">
	select NVL(COUNT(*),0) from giupreview g
	left outer join reviewphoto r on g.rep_Num = r.rep_Num
	left outer join reviewreply rr on g.rep_Num = rr.rep_Num
	where g.g1_Num = #{g1_Num}
</select>
</mapper>